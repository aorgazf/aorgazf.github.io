<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/www.alvaroorgaz.com\/"
        },
        "articleSection" : "post",
        "name" : "SuperDucky",
        "headline" : "SuperDucky",
        "description" : "\x3cp\x3eSuperDucky is an enhanced version of \x3ca href=\x22https:\/\/hakshop.com\/products\/usb-rubber-ducky-deluxe\x22\x3eHack5 Rubber Ducky\x3c\/a\x3e BadUSB.\x3c\/p\x3e",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2018",
        "datePublished": "2018-11-05 21:05:33 \x2b0530 \x2b0530",
        "dateModified" : "2018-11-05 21:05:33 \x2b0530 \x2b0530",
        "url" : "https:\/\/www.alvaroorgaz.com\/post\/superducky\/",
        "wordCount" : "1225",
        "image" : "https://www.alvaroorgaz.com//img/CJMCU-3212_BadUSB_Top.png"",
        "keywords" : [ ""Hardware Security"","Blog" ]   
    }
    </script>


 <title>SuperDucky </title>


<meta name="description" content="Alvaro Orgaz Cybersecurity Projects Protfolio" />



<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" id="ct-tracks-google-fonts-css" href="https://fonts.googleapis.com/css?family=Raleway%3A400%2C700&amp;subset=latin%2Clatin-ext&amp;ver=4.7.2" type="text/css" media="all">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

<link href="https://www.alvaroorgaz.com/css/style.css?v=1568004696" rel="stylesheet" id="theme-stylesheet" type='text/css' media='all'>

<link href="https://www.alvaroorgaz.com/css/custom.css?v=1568004696" rel="stylesheet" type='text/css' media='all'>
<link rel="shortcut icon" href="https://www.alvaroorgaz.com/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="https://www.alvaroorgaz.com/img/favicon.ico" type="image/x-icon">


</head>


<body class="post-template-default single single-post single-format-standard ct-body singular singular-post not-front standard">

  <div id="overflow-container" class="overflow-container">
    <a class="skip-content" href="#main">Skip to content</a>
    <header id="site-header" class="site-header" role="banner">
      <div class='top-navigation'>
        <div class='container'>

  <div id="menu-secondary" class="menu-container menu-secondary" role="navigation">
    <button id="toggle-secondary-navigation" class="toggle-secondary-navigation"><i class="fas fa-plus"></i></button>

    <div class="menu">

      <ul id="menu-secondary-items" class="menu-secondary-items">
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/cybersecurity">cybersecurity</a>
        </li>
        

      </ul>

    </div>

  </div>


  <ul class="social-media-icons">


    

    

    

    

    

    
    <li>
      <a href="https://www.linkedin.com/in/alvaroorgaz" data-animate-hover="pulse" class="linkedin" target="_blank">
        <i class="fab fa-linkedin-in" title="linkedin"></i>
        <span class="screen-reader-text">linkedin</span>
      </a>
    </li>
    

    


    
    <li>
      <a href="https://github.com/aorgazf" data-animate-hover="pulse" class="github" target="_blank">
        <i class="fab fa-github" title="github"></i>
        <span class="screen-reader-text">github</span>
      </a>
    </li>
    


    

    


  </ul></div>

      </div>

      <div class="container">
        <div id="title-info" class="title-info">
  <div id='site-title' class='site-title'>
    
    <a href="/"> ÁLVARO ORGAZ </a>
    </div>
  </div>
  <button id="toggle-navigation" class="toggle-navigation">
    <i class="fas fa-bars"></i>
  </button>

  <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
  <div id="menu-primary" class="menu-container menu-primary" role="navigation">
    
    <p class="site-description">Security Projects Protfolio</p>
    

    <div class="menu">
      <ul id="menu-primary-items" class="menu-primary-items">
        
        
        <li class='menu-item menu-item-type-custom menu-item-object-custom '>
          <a href="https://www.alvaroorgaz.com/">Home</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://www.alvaroorgaz.com/about/">About</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://www.alvaroorgaz.com/contact/">Get in touch</a>
          
        </li>
        
      </ul>
    </div>

  </div>

      </div>
    </header>

    <div id="main" class="main" role="main">

      
  
  
    
  
  
  <div id="loop-container" class="loop-container">
    
    <div class="post type-post status-publish format-standard has-post-thumbnail hentry category-design tag-design tag-standard-2 tag-tagalicious tag-travel entry full-without-featured odd excerpt-1">

      <div class='featured-image lazy lazy-bg-image'  data-background="https://www.alvaroorgaz.com/img/CJMCU-3212_BadUSB_Top.png">
      </div>
      
        <div class="entry-meta">
          <span class="date">05 November</span>	<span> / </span>

          <span class="author">
            <a href="https://www.alvaroorgaz.com/" title="Posts by Alvaro Orgaz" rel="author">Alvaro Orgaz</a>
          </span>


          
          <span class="category">
            <span> / </span>

            <a href="/categories/cybersecurity">Cybersecurity</a>
          </span>
          


        </div>
        <div class='entry-header'>
          <h1 class='entry-title'> SuperDucky</h1>
        </div>
        <div class="entry-container">
          <div class="entry-content">
            <article>
              <p>SuperDucky is an enhanced version of <a href="https://hakshop.com/products/usb-rubber-ducky-deluxe">Hack5 Rubber Ducky</a> BadUSB.</p>

<h3 id="introduction">Introduction</h3>

<p>The device can be programmed to emulate a USB keyboard (HID Human Interface Device) and inject keystrokes on the target computer based on scripts (payloads) that are either preloaded or sent via WiFi.</p>

<p>Although it is a little wider than most USB drives nowadays, it is fairly easy to disguise it as a flash drive or embed it within many USB-powered devices like power banks, USB mug heaters, USB fans, etc.</p>

<p>The device is able to issue keystrokes at speeds of over 1000 words per minute, making it possible to inject complex payloads within seconds.</p>

<h3 id="disclaimer">Disclaimer</h3>

<p>This project was developed exclusively to demonstrate and raise awareness of the security vulnerabilities of many systems. Advice on how to protect your system from devices like this can be found below. If you intend to fabricate this device, please make sure beforehand that is legal to do so in your country and ensure that any tests carried out with it are done on your own devices.
The author provides no warranty and takes no responsibility whatsoever over any of the information provided within this article.</p>

<h3 id="credits">Credits</h3>

<p>This project aims to combine and extend the best features of <a href="https://github.com/mharjac/bad_ducky">Mario Harjac bad_ducky</a> and <a href="https://github.com/spacehuhn/wifi_ducky">Stefan Kremser wifi_ducky</a>, which are both based on the very popular <a href="https://github.com/hak5darren/USB-Rubber-Ducky">Darren Kitchen USB-Rubber-Ducky</a>, <a href="https://github.com/whid-injector/WHID">Luca Bongiorni WHID Injector</a> and <a href="https://github.com/exploitagency/ESPloitV2">Corey Harding ESPloitV2</a>.</p>

<p>The software makes use of several open source libraries from <a href="https://github.com/me-no-dev">me-no-dev</a> and <a href="https://github.com/NicoHood">NicoHood</a>.
If you believe you should be mentioned in this section, please send me a message.</p>

<h3 id="how-it-works">How it works</h3>

<p>Practically every computing device accepts human input from keyboards. When connected to a USB port, keyboards announce themselves to computers as Human Interface Devices (HID) and are in turn automatically recognized and trusted, without the need to install any additional software or administrator rights.</p>

<p>As soon as the device is connected to a computer it presents itself as a keyboard and delivers the payload that it was programmed to execute in advance, or waits for instructions to come remotely via WiFi.</p>

<p><a href="https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Payloads">Payloads</a> are easily crafted using a simple scripting language <a href="https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Duckyscript">(Ducky Script)</a>.</p>

<h3 id="hardware">Hardware</h3>

<p>SuperDucky uses <em>CJMCU-3112 BadUSB with WiFi</em>, a modified version of an Arduino Leonardo (ATmega32u4) loaded with the WiFi module AI-Thinker ESP12e (ESP8266) and an onboard SD card reader, which can be purchased from <a href="https://www.aliexpress.com/wholesale?catId=0&amp;initiative_id=SB_20180813103305&amp;SearchText=CJMCU-3212">AliExpress</a> for less than 20$.</p>

<p><img src="/img/CJMCU-3212_BadUSB_Top.png" alt="top" width="200px"/><img src="/img/CJMCU-3212_BadUSB_Botom.png" alt="bottom" width="200px"/></p>

<h3 id="software">Software</h3>

<p>The device has two micro controllers, the ATmega32u4 (which has access to the USB interface) and the ESP8266, which handles the WiFi interface. Both micro controllers need to be programmed with their specific firmware.</p>

<p>In order to do so we first need to install the following software and libraries:</p>

<ul>
<li><a href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a></li>
<li><a href="https://github.com/esp8266/Arduino">ESP8266 Board</a> Library

<ul>
<li>File -&gt; Preferences -&gt; Additional Boards Manager URL -&gt; <a href="http://arduino.esp8266.com/stable/package_esp8266com_index.json">http://arduino.esp8266.com/stable/package_esp8266com_index.json</a> -&gt; Ok</li>
<li>Tools -&gt; Board -&gt; Boards Manager&hellip; -&gt; ESP8266 -&gt; Install</li>
</ul></li>
<li><a href="https://github.com/me-no-dev/ESPAsyncWebServer">ESPAsyncWebServer</a> Library - <a href="https://github.com/me-no-dev/ESPAsyncWebServer/archive/master.zip">(Download)</a>

<ul>
<li>Sketch -&gt; Include Library -&gt; Add .ZIP Library&hellip;</li>
</ul></li>
<li><a href="https://github.com/me-no-dev/ESPAsyncTCP">ESPAsyncTCP</a> Library - <a href="https://github.com/me-no-dev/ESPAsyncTCP/archive/master.zip">(Download)</a>

<ul>
<li>Sketch -&gt; Include Library -&gt; Add .ZIP Library&hellip;</li>
</ul></li>
<li><a href="https://github.com/NicoHood/HID">HID-Project</a> Library - <a href="https://github.com/NicoHood/HID/archive/master.zip">(Download)</a>

<ul>
<li>Sketch -&gt; Include Library -&gt; Add .ZIP Library&hellip;</li>
</ul></li>
</ul>

<p>Once the Arduino IDE and the required libraries are installed we can proceed to download and extract the <a href="./firmware.zip">firmware</a> to be uploaded to the microcontrollers. There is no need for additional hardware or programmer since both microcontrollers can be programmed connecting the device to the USB port of the computer.</p>

<h4 id="programming-esp8266">Programming ESP8266</h4>

<p>The ESP8266 microcontroller does not have direct access to the USB interface of the device. Until the microcontroller is loaded with a firmware that allows OTA programming, the microcontroller needs to be programmed through the ATmega32u4, which is programmed first with a loader that will forward any bytes received from USB port on to the ESP8266.</p>

<ul>
<li><p><strong>Program ATmega32u4 with Loader Firmware</strong>. This firmware is required to be able to program the ESP8266 through the USB interface of the device.</p>

<ul>
<li>Open Ardunio IDE</li>
<li>Open <code>SuperDucky_Loader.ino</code> Sketch: File -&gt; Open&hellip;</li>
<li>Setup target board: Tools -&gt; Board -&gt; Arduino Leonardo</li>
<li>Setup COM port: Tools -&gt; Port -&gt; COM X (Arduino Leonardo)</li>
<li>Compile and upload the firmware: Sketch -&gt; Upload</li>
</ul></li>

<li><p><strong>Program ESP8266</strong>. This firmware is responsible for providing WiFi connection and serving the web site to manage the device
In order to set the ESP8266 in programming mode, its pin #18 <code>GPIO0</code> needs to be connected to GND during the whole programming operation:
<img src="/img/ESP12e_8266.png" alt="" />
This can be achieved by using a jumper wire to connect between these two points:
<img src="/img/Wiring_for_ESP82666_flashing_1.png" alt="top" width="300px"/></p></li>
</ul>

<p>Or by temporarily welding these two pads together:</p>

<p><img src="/img/Wiring_for_ESP82666_flashing_2.png" alt="top" width="300px"/></p>

<p>Once the jumper is installed, insert the device in the USB port and proceed with the following steps:</p>

<ul>
<li>Open Ardunio IDE</li>
<li>Open <code>SuperDucky_ESP8266.ino</code> Sketch: File -&gt; Open&hellip;</li>
<li>That will also open <code>data.h</code>, <code>settings.h</code> &amp; <code>settings.cpp</code></li>
<li>Change WiFi credentials as needed</li>
<li>Setup target board: Tools -&gt; Board -&gt; Generic ESP8266 Module</li>
<li>Setup COM port: Tools -&gt; Port -&gt; COM X (Arduino Leonardo)</li>
<li>Setup other programming settings:</li>
</ul>

<p><img src="/img/Arduino_IDE_Settings_for_ESP8266_Flashing.png" alt="" /></p>

<ul>
<li>Compile and upload the firmware: Sketch -&gt; Upload
<br /></li>
</ul>

<p>After the firmware is uploaded, remove the jumper (or the welding) to set the ESP8266 micro controller into normal operation mode and reinsert the device in the USB port.</p>

<h4 id="programming-atmega32u4">Programming ATmega32u4</h4>

<p>Once the ESP8266 is programmed proceed to program the ATmega32u4 with the firmware that will emulate USB devices, read scripts and issue keystrokes.</p>

<ul>
<li>Open Ardunio IDE</li>
<li>Open <code>SuperDucky_ATmega32u4.ino</code> Sketch: File -&gt; Open&hellip;</li>
<li>Setup target board: Tools -&gt; Board -&gt; Arduino Leonardo</li>
<li>Setup COM port: Tools -&gt; Port -&gt; COM X (Arduino Leonardo)</li>
<li>Compile and upload the firmware: Sketch -&gt; Upload</li>
</ul>

<h4 id="loading-scripts-and-configuration">Loading Scripts and Configuration</h4>

<p>Once the programming of the micro controllers is completed, the SD card can be formatted and loaded with the configuration file and a library of scripts. The configuration file <code>settings.cfg</code> sets the mode of operation (continuous delivery, one time delivery &amp; management), the keyboard language (by default English) and the scripts to be executed.</p>

<h3 id="feature-summary">Feature Summary</h3>

<ul>
<li>Compatible with <a href="https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Duckyscript">Rubber Ducky scripts</a> (all commands are supported)</li>
<li>Scripts can be loaded to the ESP8266 flash memory or to the SD card and selected for deployment without the need to recompile/reflash the microcontrollers</li>
<li>There is no limit to the payload size (limited only by the size of the SD card)</li>
<li>It supports different keyboard languages</li>
<li>Script execution and Live Command execution can be done remotely via WiFi</li>
<li>Files can be exchanged between the target and the device via serial port, mass storage, or WiFi (http or ftp)(allowing data exfiltration and downloading of executables without access to internet).</li>
<li><img src="/img/new.png" alt="" /> Scripts and files can be uploaded to the ESP8266 flash memory or to the SD card via WiFi</li>
<li><img src="/img/new.png" alt="" /> Multiple scripts can be set for execution</li>
<li><img src="/img/new.png" alt="" /> Scripts can call other scripts, allowing modular execution</li>
<li><img src="/img/new.png" alt="" /> Status feedback / data can be received using CapsLock, NumLock &amp; ScrollLock LEDs (or through serial port)</li>
<li><img src="/img/new.png" alt="" /> Conditional execution based on feedback</li>
<li><img src="/img/new.png" alt="" /> Scheduling the execution of scripts at a specific time</li>
<li><img src="/img/new.png" alt="" /> Keyboard works with BIOS</li>
</ul>

<h3 id="in-progress">In Progress</h3>

<p><a name="inprogresss"></a></p>

<ul>
<li><img src="/img/inprogress.png" alt="" /> Mass Storage Device Emulation</li>
<li><img src="/img/inprogress.png" alt="" /> Wifi Client</li>
<li><img src="/img/inprogress.png" alt="" /> File Storage</li>
<li><img src="/img/inprogress.png" alt="" /> Email Client</li>
<li><img src="/img/inprogress.png" alt="" /> Send Snapshots over wifi</li>
<li><img src="/img/inprogress.png" alt="" /> VCN server</li>
<li><img src="/img/inprogress.png" alt="" /> No need for flasher, ATmega32u4 firmware forwards data to the ESP after parsing for dedicated commands</li>
<li><img src="/img/inprogress.png" alt="" /> Script Encryption</li>
<li><img src="/img/inprogress.png" alt="" /> VID &amp; PID can be customised (to prevent blacklisting Arduinos)</li>
<li>Cactus WHID functionality, DNS fake servers, FTP, etc.</li>
</ul>

<h3 id="protection-against-superducky">Protection Against SuperDucky</h3>

<p>Protect access to BIOS with password
Don&rsquo;t grant Admin Rights to the user
Monitor keyboard writing speed
Capture Focus
TODO check on internet</p>

<h3 id="todo">TODO</h3>

<ul>
<li>Optimise minify to remove comments</li>
<li>Incorporate best features of ESPloitV2 firmware</li>
<li></li>
</ul>

<p><a href="https://github.com/sensepost/USaBUSe">USaBUSe</a>
<a href="https://www.tindie.com/products/mux/nanohub-tiny-usb-hub-for-hacking-projects/">Nano Hub</a></p>
            </article>
          </div>
          
      <div class='entry-meta-bottom'>
        

  <div class="entry-categories"><p><span>Categories</span>
    
    <a href="/categories/cybersecurity" title="View all posts in Cybersecurity">Cybersecurity</a>
  </p>
</div>



<div class="entry-tags"><p><span>Tags</span>
  
  <a href="/tags/hardware-security" title="View all posts tagged Hardware Security">Hardware Security</a>
  

</p></div>	</div>

	
<div class="author-meta">

  <div class="author">
    	
      <img alt='Alvaro Orgaz' src="https://www.gravatar.com/avatar/97c104bc334ae27bece34791f76d41b0?s=100&d=identicon" class='avatar avatar-72 photo' height='72' width='72'>
    
    <span>
      Written by:<a href="https://www.alvaroorgaz.com/" title="Posts by Alvaro Orgaz" rel="author">Alvaro Orgaz</a> </span>
    </div>
    <div class="bio">
      
      
      <p>Alvaro Orgaz is an Information Security professional and enthusiast about Artificial Intelligence, IoT, Reverse Engineering and Ethical Hacking.</p>
      
      
	
      

    


  

<a class="linkedin" target="_blank"
href="https://www.linkedin.com/in/alvaroorgaz">
<i class="fab fa-linkedin"
title="linkedin icon"></i>
</a>









<a class="github" target="_blank"
href="https://github.com/aorgazf">
<i class="fab fa-github"
title="github icon"></i>
</a>









</div>
</div>

</div>
</div>

<section id="comments" class="comments">
  

  




</section>
</div>

 



    </div>

    <footer id="site-footer" class="site-footer" role="contentinfo">
	<h1>
    
    <a href=""> ÁLVARO ORGAZ </a>
    
	</h1>

			
			<p class="site-description">Security Projects Protfolio</p>
			

		<div id="menu-footer" class="menu-container menu-footer" role="navigation">
		<div class="menu">

      <ul id="menu-footer-items" class="menu-footer-items">
        
</ul>

</div>	</div>

<ul class="social-media-icons">

        

        


        

        

        

        
        <li>
        <a href="https://www.linkedin.com/in/alvaroorgaz" class="linkedin" target="_blank">
            <i class="fab fa-linkedin-in" title="linkedin"></i>
            <span class="screen-reader-text">linkedin</span>
        </a>
        </li>
        

        


        
        <li>
        <a href="https://github.com/aorgazf"  class="github" target="_blank">
            <i class="fab fa-github" title="github"></i>
            <span class="screen-reader-text">github</span>
        </a>
        </li>
        


        

        

				</ul>	<div class="design-credit">
		
		<p>&copy; 2019 Alvaro Orgaz</p>
		
		<p>Nederburg Hugo Theme by <a href="https://appernetic.io">Appernetic</a>.</p>
		
	</div>
</footer>

  </div>
  <script src="https://www.alvaroorgaz.com/js/jquery.min.js"></script>
<script src="https://www.alvaroorgaz.com/js/jquerymigrate.js"></script>
<script src="https://www.alvaroorgaz.com/js/production.min.js?v=1568004696"></script>

</body>
</html>
